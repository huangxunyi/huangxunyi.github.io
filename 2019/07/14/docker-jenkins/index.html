<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Docker
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。

&amp;nbsp;">
    

    <!--Author-->
    
        <meta name="author" content="John Doe">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Docker Jenkins自动构建"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Hexo"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Docker Jenkins自动构建 - Hexo</title>

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        <a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="Hexo">
            <img src="http://www.codeblocq.com/assets/projects/hexo-theme-anodyne/assets/anodyne.svg" class="dib h3" alt="Hexo">
        </a>
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/" 
                    title="Home">
                    Home
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/archives" 
                    title="Archives">
                    Archives
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/tags" 
                    title="Tags">
                    Tags
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/categories" 
                    title="Categories">
                    Categories
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/about.html" 
                    title="About">
                    About
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" 
                    href="/contact.html" 
                    title="Contact">
                    Contact
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">Docker Jenkins自动构建</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">2019-07-14</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa-file-text-o"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    
                        <div class="tags-container-vertical">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/tags/jenkins/">#jenkins</a> <a class="fw3 ph1 dib" href="/tags/docker/">#docker</a> <a class="fw3 ph1 dib" href="/tags/Github-Webhooks/">#Github Webhooks</a>
                            </div>
                        </div>
                    

                    <!-- Main Post Content -->
                    <h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。</p>
</blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp; 之所以使用Docker运行Jenkins,是因为即可以通过Docker快速部署,又可以轻松把一个Docker容器里的资料在另一个设备中轻松备份Jenkins环境与配置,还可以隔离物理机环境,使Jenkins构架环境不受本地环境影响,当然还有很重要的一点,可以通过Docker实现快速的配置多Jenkins节点. </p>
<h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><p>个人喜欢用官方脚本安装Docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -qO- https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure>

<p>安装中会提示输入 <code>root密码</code> ,安装结束后还会提示把 <code>当前用户</code> 添加到docker用户组中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod -aG docker $USERNAME   # 该命令reboot后生效</span><br></pre></td></tr></table></figure>

<p>这样就可以在 <code>当前用户</code> 中使用  <strong>$ docker COMMAND</strong> 而不会出现</p>
<blockquote>
<p>Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/containers/json: dial unix /var/run/docker.sock: connect: permission denied</p>
</blockquote>
<hr>
<h2 id="Github-Webhooks"><a href="#Github-Webhooks" class="headerlink" title="Github Webhooks"></a>Github Webhooks</h2><p>&nbsp;&nbsp;&nbsp;&nbsp; Github Webhooks可以理解为代码仓库的钩子,当订阅了Github中的某些事件过,这些事件被触发(如:git push),则将会向配置的URL发送一个HTTP POST请求.通过这个请求,可以利用Jenkins自动建构,部署.  <code>You&#39;re only limited by your imagination.</code></p>
<blockquote>
<p>具体Webhooks介绍以及其所支持的构建方式可以参考 : <a href="https://developer.github.com/webhooks/" target="_blank" rel="noopener" title="webhooks">Github Webhooks</a></p>
</blockquote>
<hr>
<h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/docker-jenkins.png" alt="docker-jenkins" title="docker-jenkins"></p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Jenkins是开源CI&amp;CD软件领导者， 提供超过1000个插件来支持构建、部署、自动化， 满足任何项目的需要。<br>Jenkins 支持各种运行方式，可通过系统包、Docker 或者通过一个独立的 Java 程序。</p>
</blockquote>
<hr>
<h3 id="拉取-Jenkins-官方镜像"><a href="#拉取-Jenkins-官方镜像" class="headerlink" title="拉取 Jenkins 官方镜像"></a>拉取 Jenkins 官方镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull jenkins/jenkins</span><br></pre></td></tr></table></figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 不推荐使用 <del>docker pull jenkins</del>  因为在<a href="https://hub.docker.com/_/jenkins" target="_blank" rel="noopener" title="docker-hub">docker-hub</a> 中 :</p>
<blockquote>
<p>This image has been deprecated in favor of the jenkins/jenkins:lts image provided and maintained by Jenkins Community as part of project’s release process. The images found here will receive no further updates after LTS 2.60.x. Please adjust your usage accordingly. </p>
</blockquote>
<p><code>即 :</code>  <strong>该镜像已经被弃用,取而代之的是</strong> <a href="https://hub.docker.com/r/jenkins/jenkins" target="_blank" rel="noopener" title="jenkins/jenkins:lts">jenkins/jenkins:lts</a> 但文档还是推荐阅读 <a href="https://hub.docker.com/_/jenkins" target="_blank" rel="noopener" title="jenkins">jenkins</a></p>
<p>如果镜像拉取较慢,可以使用 <a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener" title="DaoCloud镜像加速">Aliyun镜像加速服务</a> 或者使用 <a href="https://www.daocloud.io/mirror" target="_blank" rel="noopener"" title="DaoCloud镜像加速">DaoCloud镜像加速</a> , 待镜像拉取完毕后执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name myjenkins -p 8081:8080 -p 50000:50000 -v /&#123;local_jenkins_home&#125;:/var/jenkins_home jenkins/jenkins</span><br></pre></td></tr></table></figure>

<p>其中 :</p>
<ul>
<li><p><code>-d</code> 表示后台运行  </p>
</li>
<li><p><code>-p 8081:8080</code> 是将本机的 <code>8081</code> 端口映射到docker <code>容器中的8080</code> 端口,而8080端口是 Jenkins 默认的Web访问端口</p>
</li>
<li><p><code>-p 50000:50000</code> <code>50000</code>端口将会在Jenkins链接他的 <strong>从节点(slave agent)</strong> 中使用</p>
</li>
<li><p><code>-v /{local_jenkins_home}:/var/jenkins_home</code>  表示将 <code>{local_jenkins_home}</code> 映射到docker容器中的 <code>/var/jenkins_home</code> ,通过这个映射可以很方便的保存Jenkins的 <strong>备份</strong> 也方便修改一些Jenkins的配置或者配置一些环境</p>
</li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;如果直接执行这条命令,通过会发现 <strong>Jenkins容器启动失败</strong> ,通过 <code>$ docker logs myjenkins</code>查看 log 会发现:</p>
<blockquote>
<p>touch: cannot touch ‘/{local_jenkins_home}/copy_reference_file.log’: Permission denied <br><br>Can not write to /{local_jenkins_home}/copy_reference_file.log. Wrong volume permissions?</p>
</blockquote>
<p>通过jenkins的 <code>dockerfile</code> 可以看到</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> uid=<span class="number">1000</span> </span><br><span class="line"><span class="keyword">ARG</span> gid=<span class="number">1000</span> </span><br><span class="line">... </span><br><span class="line"><span class="comment"># Jenkins is run with user `jenkins`, uid = 1000 </span></span><br><span class="line"><span class="comment"># If you bind mount a volume from the host or a data container,</span></span><br><span class="line"><span class="comment"># ensure you use the same uid </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> groupadd -g <span class="variable">$&#123;gid&#125;</span> <span class="variable">$&#123;group&#125;</span> \ </span></span><br><span class="line">   &amp;&amp; useradd -d <span class="string">"$JENKINS_HOME"</span> -u $&#123;uid&#125; -g $&#123;gid&#125; -m -s /bin/bash $&#123;<span class="keyword">user</span>&#125;</span><br></pre></td></tr></table></figure>
<p>原来 因为当映射本地数据卷时，<code>容器内的uid和gid为1000</code> , 而本地文件 <code>{local_jenkins_home}</code> 的拥有者为<code>${user}</code>, <strong>因此将{local_jenkins_home}的 gid 和 uid 改为 1000 即可</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown -R 1000:1000  &#123;local_jenkins_home&#125;</span><br></pre></td></tr></table></figure>

<p>再次启动即可 <code>$ docker start myjenkins</code></p>
<p>然后访问 <code>https://{ip}:{port}</code>即可看到<br><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/unlock.png" alt="Jenkins-gettingStarted1"></p>
<p>通过 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it myjenkins  cat /var/jenkins_home/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>
<p>拿到密码复制粘贴后,稍等片刻即可看到</p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/gettingStarted.png" alt="Jenkins-gettingStarted2"><br>如果想自定义安装插件的话可以选择第二个,这里我们选择 <code>第一个 安装建议插件</code></p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/install-plugin.jpg" alt="Jenkins-installing-plugins"></p>
<p>如果安装过程中出现某些插件安装 <em>失败</em> 可以选择 <code>重试</code> 或者 放弃安装 ,如果有需要可以后面自行安装,如果安装顺利便会提示创建一个账户</p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/create-account.jpg" alt="create-account"></p>
<p>这里的邮箱建议填一个常用的邮箱,因为这个邮箱稍后会被作为构建事件结果的通知邮箱</p>
<p>然后一直下一步即可看到主界面</p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/jenkins-index.png" alt="jenkins主界面"></p>
<hr>
<h3 id="生成-Github-Access-Token"><a href="#生成-Github-Access-Token" class="headerlink" title="生成 Github Access Token"></a>生成 Github Access Token</h3><p><code>github</code> -&gt; <code>settings</code> -&gt; <code>Developer settings</code> -&gt; <code>Personal access tokens</code> -&gt; <code>Genarate new token</code></p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/generate-new-token.jpg" alt="generate-new-token"></p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/token.jpg" alt="token"></p>
<p>记得 <strong>一定</strong> 要保存这个 <code>token</code> ,因为一旦丢失,便  <strong><font color=red>无法找回!</font></strong></p>
<hr>
<h3 id="创建Github-Webhooks"><a href="#创建Github-Webhooks" class="headerlink" title="创建Github Webhooks"></a>创建Github Webhooks</h3><p><code>进入Github项目</code> -&gt; <code>Settings</code> -&gt; <code>Webhooks</code> -&gt; <code>add webhook</code> </p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/add-webhook.jpg" alt="add-webhook"></p>
<ul>
<li><strong>Payload URL</strong> : Jenkins公网地址 http(s)://{ip}:{port}</li>
<li><strong>Content type</strong> : application/json</li>
<li><strong>Secret</strong> : (可留空)</li>
</ul>
<p>然后 <code>add webhook</code> </p>
<hr>
<h3 id="配置Jenkins-Github-Plugin"><a href="#配置Jenkins-Github-Plugin" class="headerlink" title="配置Jenkins Github Plugin"></a>配置Jenkins Github Plugin</h3><p><code>系统管理(Manage Jenkins)</code> -&gt; <code>系统设置(Configure System)</code> -&gt; <code>找到 Github</code></p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/jenkins-github-server.png" alt="jenkins-github-server"></p>
<p><code>添加 Github 服务器 (Add Github Server)</code></p>
<ul>
<li><strong>名称</strong> : 随意</li>
<li><strong>API URL</strong> : <code>https://api.github.com</code></li>
<li><strong>凭据</strong> :        <code>添加 ↓</code></li>
</ul>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/config-secure-text.png" alt=""></p>
<ul>
<li><strong>Domain</strong> :  默认  <code>全局凭据(unrestricted)</code> (<code>Global credentials(unrestricted)</code>)</li>
<li><strong>类型(Kind)</strong> : 选择  <code>Secure Text</code><ul>
<li><strong>范围</strong> : 默认 <code>全局</code></li>
<li><strong>Secret</strong> : 刚才 生成的 <code>Github Token</code></li>
<li><strong>ID</strong> : 可为空</li>
<li><strong>描述(Description)</strong> : 随意</li>
</ul>
</li>
</ul>
<p>设置完成后可以选择 <code>测试连接(Test connection)</code> ,如果配置无误,则会出现 :</p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/test-connection.jpg" alt="Test connection"></p>
<p><code>应用</code> 设置后回到主界面</p>
<hr>
<h3 id="配置JAVA环境"><a href="#配置JAVA环境" class="headerlink" title="配置JAVA环境"></a>配置JAVA环境</h3><p><code>系统管理(Manage Jenkins)</code> -&gt; <code>全局工具配置(Global Tool Configuration)</code> -&gt; <code>JDK</code> -&gt; <code>JDK安装</code> </p>
<ul>
<li>可以选择 自动安装<br><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/install-jdk.png" alt=""></li>
</ul>
<p>手动安装将会从Oracle官网下载JDK,几乎支持所有Oracle官方上提供的JDK下载,但是需要输出Oracle账号密码.</p>
<ul>
<li>也可以手动指定JAVA_HOME </li>
</ul>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/install-jdk-manual.png" alt=""></p>
<p> 这时候前面-v 映射的目录就派上用场了,把下载好的JDK解压到映射的路径中:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf &#123;jdk-*-linux-*.tar.gz&#125; -C &#123;local_jenkins_home&#125;</span><br></pre></td></tr></table></figure>

<p><strong>别名</strong> 填 <code>java+版本号</code> , <strong>JAVA_HOME</strong> 填  <code>/var/jenkins_home/{JDK文件夹名}</code> ,因为本地 <code>{local_jenkins_home}</code> 映射的是容器中的 <code>/var/jenkins_home</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jenkins home directory is a volume, so configuration and build history </span></span><br><span class="line"><span class="comment"># can be persisted and survive image upgrades</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /var/jenkins_home</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="安装MAVEN"><a href="#安装MAVEN" class="headerlink" title="安装MAVEN"></a>安装MAVEN</h3><p><code>系统管理(Manage Jenkins)</code> -&gt; <code>全局工具配置(Global Tool Configuration)</code> -&gt; <code>MAVEN</code> -&gt; <code>新增MAVEN</code> </p>
<p>与安装JDK同理,可以选择自动安装,也可以自己手动安装.</p>
<p>如果没有特殊的需求,可以选择自动安装,简单省事</p>
<p><strong>值得注意的是</strong> <code>系统管理(Manage Jenkins)</code> -&gt; <code>全局工具配置(Global Tool Configuration)</code> -&gt; <code>MAVEN</code> -&gt; <code>MAVEN 配置</code> 中可以指定 Setting文件,可以通过 <code>{local_jenkins_home} + /var/jenkins_home</code> 的 方式指定</p>
<hr>
<h3 id="安装-Maven-Integration"><a href="#安装-Maven-Integration" class="headerlink" title="安装 Maven Integration"></a>安装 Maven Integration</h3><p><code>系统管理(Manage Jenkins)</code> -&gt; <code>插件管理(ManagePlugins)</code> -&gt; <code>可选插件(available)</code>  -&gt;  <code>Maven Integration</code><br><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/maven-plugin.png" alt="maven-plugin"></p>
<p><em>建议</em> : 下载待重启后安装</p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/install.png" alt="install-plugin"></p>
<p>然后勾选  <code>安装完成后重启Jenkins(空闲时)</code> , 待Jenkins重启完成即可 </p>
<p><em>ps:重启后中文的翻译似乎完整了许多,第一次启动Jenkins汉化没完全,所以有些步骤中文后会有一个英文括号</em></p>
<h3 id="新建任务"><a href="#新建任务" class="headerlink" title="新建任务"></a>新建任务</h3><p>主界面选择 <code>新建任务(newJob)</code> -&gt; 输入项目名称然后选择 <code>建构一个maven项目</code>, 确定</p>
<p><img src="https://image-1252310512.cos.ap-beijing.myqcloud.com/img/project-config1.png" alt=""><br><br></p>
<hr>
<br>
![](https://image-1252310512.cos.ap-beijing.myqcloud.com/img/project-config2.png)
 ---
// TODO 


<h2 id="Jenkins-升级"><a href="#Jenkins-升级" class="headerlink" title="Jenkins 升级"></a>Jenkins 升级</h2><p>由于Docker容器的jenkins_home已经映射到本地目录,因此升级Jenkins非常简单</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull jenkins/jenkins:latest  <span class="comment"># 拉取最新的jenkins镜像</span></span><br><span class="line">docker stop myjenkins    <span class="comment"># 停止jenkins容器</span></span><br><span class="line">docker rm myjenkins      <span class="comment"># 删除jenkins容器</span></span><br><span class="line">docker run -d --name myjenkins -p 8081:8080 -p 50000:50000 -v /&#123;local_jenkins_home&#125;:/var/jenkins_home jenkins/jenkins</span><br></pre></td></tr></table></figure>
<p>稍等jenkins启动完成,重新访问即可</p>
<p>至于没有映射本地目录的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect --format <span class="string">'&#123;&#123; (index (index .Mounts) 0).Source &#125;&#125;'</span></span><br></pre></td></tr></table></figure>

<p>输出的就是 默认 Volume 所在的位置,把 <code>_data</code> <code>cp</code> 出来并命名为jenkins_home</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -s</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">cp _data -r  &#123;local_jenkins_home&#125;  <span class="comment"># 改成自己的路径</span></span><br><span class="line">sudo chown -R 1000:1000 &#123;local_jenkins_home&#125;  <span class="comment"># 改成自己的路径</span></span><br><span class="line">docker stop myjenkins</span><br><span class="line">docker rm myjenkins</span><br><span class="line">docker run -d --name myjenkins -p 8081:8080 -p 50000:50000 -v /&#123;local_jenkins_home&#125;:/var/jenkins_home jenkins/jenkins</span><br></pre></td></tr></table></figure>
<p><em>这是我自己研究出来的 “野路子”, 如果有更好的方法请赐教</em></p>
<h4 id="Volumn清理"><a href="#Volumn清理" class="headerlink" title="Volumn清理"></a>Volumn清理</h4><p>值得注意的是 docker rm {容器ID} 后 <code>/var/lib/docker/volumn</code> 中的卷是不会删除的<br>要删除的话有两种方法,一种是在删除容器的时候使用</p>
<blockquote>
<p>$  docker rm -v {容器ID}   </p>
</blockquote>
<p>但是我个人不太喜欢这种方式,如果数据删错了就凉了</p>
<p>另一种是</p>
<blockquote>
<p>$ docker volume prune </p>
</blockquote>
<p>这种方式会删除 <strong>所有</strong> 未被引用的volume,如果想只删除特定的卷可以使用</p>
<blockquote>
<p>$ docker volume  rm {id}</p>
</blockquote>
<p>待续 …</p>

                    
                    <!-- Tags Bottom -->
                    
                        <div class="tags-container-bottom">
                            <i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/jenkins/">#jenkins</a> <a class="fw3 ph1 dib" href="/tags/docker/">#docker</a> <a class="fw3 ph1 dib" href="/tags/Github-Webhooks/">#Github Webhooks</a>
                        </div>
                    

                    <!-- Comments -->
                    



                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                    
                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 1: About -->
                    <div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="http://tachyons.io/img/avatar_1.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="John Doe">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            My name is Jonathan Klughertz and this is my blog.<br>I am a full stack software engineer with a strong front-end focus.<br> I currently live and work in Singapore, hit me up if you are in the region.
        </div>
    </article>
</div>

                    <hr class="dn-l mw4 black-50 mt5" />
                    
                    <!-- Widget 2: Categories -->
                    

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>Recent Posts</h3>
    
        <p>
            <a href="/2019/10/04/asm/">Asm</a>
        </p>
    
        <p>
            <a href="/2019/10/03/jvm/">Jvm</a>
        </p>
    
        <p>
            <a href="/2019/09/01/compile-jdk11-and-debug-use-clion/">源码编译OpenJdk11并使用Clion调试</a>
        </p>
    
        <p>
            <a href="/2019/08/18/netty-sticky-pack/">Netty 粘包解决</a>
        </p>
    
        <p>
            <a href="/2019/08/04/red-black-tree/">红黑树学习</a>
        </p>
    
</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
        <div class="mv8">
            <div class="center tc">
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://twitter.com/?lang=en" target="_blank">
                            <i class="fa fa-twitter"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://www.facebook.com/" target="_blank">
                            <i class="fa fa-facebook"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://dribbble.com/" target="_blank">
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://github.com/klugjo/hexo-theme-anodyne" target="_blank">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://plus.google.com/" target="_blank">
                            <i class="fa fa-google-plus"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://www.behance.net/" target="_blank">
                            <i class="fa fa-behance"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://500px.com/" target="_blank">
                            <i class="fa fa-500px"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="mailto:test@example.com" target="_blank">
                            <i class="fa fa-envelope"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="/#" target="_blank">
                            <i class="fa fa-rss"></i>
                        </a>
                    </div>
                
            </div>
            <div class="f6 f5-ns center tc white pt5 fw3">
                @Untitled. All right reserved | Design & Hexo <a class="link dim white" href="http://www.codeblocq.com/" target="_blank" rel="noopener">Jonathan Klughertz</a>
            </div>
        </div>
    </div>

<!-- After Footer -->
<!-- Disqus Comments -->



</body>

</html>